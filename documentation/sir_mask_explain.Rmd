---
title: "SIR and mask"
output:
  pdf_document: 
    includes:
      in_header: header.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
pacman::p_load(tidyverse)
```

## Basic idea

- Simple SIR model disease progression with strata for mask-wearing status, resulting in compartments for S-masked, S-no mask, I-masked, I-no mask, R-masked, R-no mask.
- Supposing wearing a mask reduces both susceptibility and infectiousness (depending on who is wearing it)
- Assume transitions between masked-not masked based on social influence and fear of disease (noting FD type "infection" structure for fear of disease, when could actually be more about absolute number/density dependence -- interesting question to explore how structure affects dynamics)
- Work in proportions such that S + I + R = 1
- no demography

## State diagram

\begin{center}
\begin{tikzpicture}[node distance=2cm and 1cm,>=stealth',auto, every place/.style={draw}]
    
    \node [place] (Sm) {$S_M$};
    \node [place] (Sn) [below=of Sm] {$S_{N}$};
    \node [place] (Im) [node distance=2.5cm,right=of Sm] {$I_M$};
    \node [place] (In) [below=of Im] {$I_{N}$};
    \node[place] (Rm) [node distance=2.5cm, right=of Im] {$R_M$};
    \node[place] (Rn) [below=of Rm] {$R_N$};
    
    \path[->] (Sm) edge [bend left] node {$\alpha$} (Sn);
    \path[->] (Sn) edge [bend left] node {$\omega$} (Sm);
    \path[->] (Im) edge [bend left] node {$\alpha$} (In);
    \path[->] (In) edge [bend left] node {$\omega$} (Im);
    \path[->] (Rm) edge [bend left] node {$\alpha$} (Rn);
    \path[->] (Rn) edge [bend left] node {$\omega$} (Rm);
    
    \path[->] (Sm) edge node {$\lambda$} (Im);
    \path[->] (Sn) edge node {$\lambda$} (In);
    \path[->] (In) edge node {$\gamma$} (Rn);
    \path[->] (Im) edge node {$\gamma$} (Rm);
    

\end{tikzpicture}
\end{center}

## Parameter description

- $\lambda$ is the force of infection, assuming a form of FD
- $\frac{1}{\gamma}$ is average rate of recovery
- $\alpha$ is transition rate from wearing a mask to not wearing a mask
- $\omega$ is transition rate from not wearing a mask to wearing a mask

Further parameters that will pop up

- $\beta$ is the transmission rate
- $c$ is the reduction in chance of catching disease if S is wearing a mask # this description is inconsistent with code comment definition and `1-c` model structure (I think)
- $p$ is the reduction in chance of spreading disease if I is wearing a mask # this description is inconsistent with code comment definition and `1-p` model structure (I think)
- $\alpha_1$ is the rate of transition to no mask based on social influence of no mask
- $\alpha_2$ is the rate of transition to no mask based on fear of disease
- $\omega_1$ is the rate of transition to mask based on social influence of  mask
- $\omega_2$ is the rate of transition to no mask based on fear of disease


## Basic system of ODEs

$$
  \begin{aligned}
    \dot{S}_{M} & =  -\lambda (1-c) S_{M} - \alpha S_{M} + \omega S_{N}\\
    \dot{S}_{N} & =  -\lambda S_{N} + \alpha S_{M} - \omega S_{N}\\
    \dot{I}_{M} & = \lambda (1-c) S_{M} - \alpha I_{M} + \omega I_{N} - \gamma I_{M}\\
    \dot{I}_{N} & = \lambda S_{N} + \alpha I_{M} - \omega I_{N} - \gamma I_{N}\\
    \dot{R}_M & = \gamma I_{M}  - \alpha R_{M} + \omega R_{N}\, \\
    \dot{R}_N & = \gamma I_{N} + \alpha R_{M} - \omega R_{N} \, ,
  \end{aligned}
$$

where

$$
  \begin{aligned}
    \lambda(t) & = \beta \left( I_{N} + (1-p) I_M \right)\\
    \omega(t) & = \omega_1 (S_M + I_M + R_M) + \omega_2(I_M + I_{N})\\
    \alpha(t) & = \alpha_1 (S_{N} + I_{N} + R_N) + \alpha_2(1 - (I_M + I_{N}))\, .\\
  \end{aligned}
$$

## Next generation matrix

- The disease states are $I_M$ and $I_N$
- Cannot ignore $S_M$ and $S_N$!

The flow in is

$$
  \mathscr{F} = 
    \begin{bmatrix}
        \beta (1-c)\left( I_{N} + (1-p) I_M \right) S_M\\
        \beta \left( I_{N} + (1-p) I_M \right) S_N 
    \end{bmatrix}
$$

and flow out is

$$
  \mathscr{V} = 
    \begin{bmatrix}
        - \omega I_{N} + (\alpha + \gamma) I_{M} \\
        (\omega + \gamma) I_N -  \alpha I_{M}
    \end{bmatrix}\, .
$$

The differential of these with respect to the disease states (remembering that $\alpha$ and $\omega$ depend on $I_N$ and $I_M$) are:

$$
\begin{aligned}
  F &= 
    \begin{bmatrix}
      \beta(1-c)(1-p)S_M & \beta(1-c)S_M\\
      \beta(1-p)S_N & \beta S_N
    \end{bmatrix}\, , \\[1em]
  V &= 
    \begin{bmatrix}
      \gamma + \alpha - \alpha_2 I_M - (\omega_1 + \omega_2) I_N & (\alpha_1 - \alpha_2) I_M - \omega - \omega_2 I_N \\
      (\omega_1 + \omega_2) I_N - \alpha + \alpha_2 I_M & \gamma - (\alpha_1 - \alpha_2) I_M + \omega + \omega_2 I_N
    \end{bmatrix} \, .
\end{aligned}
$$

Then $R(t) = \sigma(t)$ where $\sigma(t)$ is the largest (absolute) eigenvalue of $(FV^{-1})(t)$.  Defining

* $x = \alpha - \alpha_2 I_M - (\omega_1 + \omega_2) I_N$, (rate of change in $I_M$ due to mask transitions)
* $y = \omega - (\alpha_1 - \alpha_2) I_M + \omega_2 I_N$, (rate of change in $I_N$ due to mask transitions)
* $a = (1 - p)(\gamma + y) + x$, (total rate of change in $I_N$ accounting for reduced infections due to mask ($1-p$)?)
* $b = (1 - p)y + \gamma + x$, and (total rate of change in $I_M$ accounting for reduced infections due to mask ($1-p$)?)
* $\Gamma = \frac{\beta}{\gamma(\gamma + x + y)}$ ($R_0$ with no mask effects ($p = c = 0$))

we can succinctly write

$$
  \sigma(t) = \Gamma\left( (1-c) S_M a + S_N b \right)\, .
$$



